###############################################################################
###############################################################################
##
##  Copyright (C) 2005 Red Hat, Inc.  All rights reserved.
##
##  This copyrighted material is made available to anyone wishing to use,
##  modify, copy, or redistribute it subject to the terms and conditions
##  of the GNU General Public License v.2.
##
###############################################################################
###############################################################################

%define vers @VERS@
%define rel @REL@

%ifarch x86_64
%define _libdir /usr/lib64
%endif

%define PEGASUS_PROVIDERS_DIR %{_libdir}/Pegasus/providers


Name: clumon
Version: %vers
Release: %rel
License: GPL

Group: System Environment/Base
Summary: Red Hat Enterprise Linux Cluster Suite - Monitoring daemon

Source: %{name}-%{version}.tar.gz
Buildroot: %{_tmppath}/%{name}-%{version}-buildroot

Requires: chkconfig initscripts
Requires: /bin/bash
Provides: clumon
BuildRequires: glibc-devel gcc-c++ libxml2-devel
BuildRequires: openssl-devel net-snmp-devel tog-pegasus-devel

%description
Monitoring daemon for Red Hat Enterprise Linux Cluster Suite


%prep
%setup -q

%build
./configure --arch=%{_arch} --sbindir=%{_sbindir} --libdir=%{_libdir} --pegasus_providers_dir=%{PEGASUS_PROVIDERS_DIR}
make

%install
rm -rf $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%doc README COPYING
%{_sbindir}/clumond
/etc/init.d/clumond

%post
/sbin/chkconfig --add clumond

%preun
if [ "$1" = 0 ]; then
   /sbin/service clumond stop > /dev/null 2>&1
   /sbin/chkconfig --del clumond
fi

%postun
if [ "$1" -ge "1" ]; then
   /sbin/service clumond condrestart > /dev/null 2>&1
fi


###  SNMP agent ###


%package snmp
Group: System Environment/Base
Summary: Red Hat Enterprise Linux Cluster Suite - SNMP agent
Requires: %{name} = %{version}-%{release}
Requires: net-snmp
Provides: clumon-snmp

%description snmp
SNMP agent for Red Hat Enterprise Linux Cluster Suite


%files snmp
%defattr(-,root,root)
%doc README COPYING REDHAT-MIB REDHAT-CLUSTER-MIB
%{_libdir}/clumon-snmp/
%attr(644,root,root) /usr/share/snmp/mibs/REDHAT-MIB
%attr(644,root,root) /usr/share/snmp/mibs/REDHAT-CLUSTER-MIB

%post snmp

%preun snmp

%postun snmp
if [ "$1" -ge "1" ]; then
   /sbin/service snmpd condrestart > /dev/null 2>&1
fi



###  CIM provider ###


%package cim
Group: System Environment/Base
Summary: Red Hat Enterprise Linux Cluster Suite - CIM provider
Requires: %{name} = %{version}-%{release}
Requires: tog-pegasus
Provides: clumon-cim

%description cim
CIM provider for Red Hat Enterprise Linux Cluster Suite

%files cim
%defattr(-,root,root)
%doc README COPYING RedHat_ClusterProvider.mof RedHat_ClusterSchema.mof
%{PEGASUS_PROVIDERS_DIR}/libRedHatClusterProvider.so

%post cim

%preun cim

%postun cim



###  changelog ###


%changelog
* Wed Dec 07 2005 Stanko Kupcevic <kupcevic@redhat.com> 0.8.1
- Temp OID replaced with unique one, misc bugfixes
* Wed Nov 23 2005 Stanko Kupcevic <kupcevic@redhat.com> 0.8.0
- Initial build
