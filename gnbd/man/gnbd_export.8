.TH gnbd_export 8

.SH NAME
gnbd_export - the interface to export GNBDs

.SH SYNOPSIS
.B gnbd_export
[\fIOPTION\fR]...

.SH DESCRIPTION
gnbd_export exports local block devices or files as GNBDs.

.SH OPTIONS
.TP
\fB-a\fP
Validate.

This option forces all server processes to send a ping message to the clients
they are connected to. This forces servers with faulty connections to quit.
.TP
\fB-c\fP
Enable caching.

Reads from the exported GNBD will take advantage of the linux page cache.
This option is used with \fB-e\fP. \fBNOTE:\fP If this option is not specified,
gnbd will run with a noticeable performance decrease.  Also, if this option
is not specified, the exported GNBD will run in timeout mode, with the
default timeout (see the \fB-t\fP option).
With the \fB-c\fP option, it is not necessary to have the gnbd server machine
be part of the cluster.  If \fB-c\fP option is not used, the server machine
must already have a cluster manager running on it. When the first uncached
gnbd is exported, the \fBgnbd_clusterd\fP daemon will be started. This daemon
connects to the cluster manager via the \fBmagma\fP interface.
\fBWARNING:\fP You must NOT specify
this option if you wish to use gnbd with dm multipathing, or run GFS on gnbd
server machines.  To set up dm multipathing over gnbd, all
GNBDs involved must run with caching disabled.  Data corruption will occur
if the GNBD devices are run with caching. Any device that is exported without
the \fB-c\fP option can also be used locally, but you must access the device
directly. You MUST NOT use gnbd_import to import devices exported from the
same machine.
.TP
\fB-d\fI pathname\fR
Device.

Specify the device to export as a GNBD.  This option is used with \fB-e\fP. 
\fIpathname\fR may be either a block device or a regular file.  Usually block 
devices are used, because this increases GNBD performance.
.TP
\fB-e\fI gnbdname\fR
Export.

Export a device as a GNBD with the Device name \fIgnbdname\fR. You must also
specify the pathname of the device with the \fB-d\fP option.  Once a GNBD 
has been exported, clients can import it with \fBgnbd_import\fP.
.TP
\fB-h\fP
Help.

Print the usage information.
.TP
\fB-l\fP 
List.

List all exported GNBDs and kgnbd_portd server information.  The listing 
contains each server's number (which is only for internal use), its Device 
name, the pathname of the device that is being exported, it's size in
512 byte sectors, and information on whether or not it is cached, and if not,
what it's timeout is.
.TP
\fB-O\fP
Override

This option allows you to unexport gnbd devices, even if they are still in
use.  When an agent other than fence_gnbd is used to fence gnbd client nodes,
occasionally gnbd server threads are not correctly cleaned up.  This causes
no performance issues. However, the affected gnbd devices cannot be unexported.
In this case, using the \fB-O\fP option with either \fB-r\fP or \fB-R\fP will
allow you to unexport the GNBD devices.  \fBWARNING:\fP Make sure
that no clients have the GNBD imported before using this option.
.TP
\fB-o\fP
Readonly

export the server in readonly mode.
.TP
\fB-q\fP 
Quiet.

Only prints out error messages.
.TP
\fB-R\fP
Remove All.

Remove all exported GNBDs.
.TP
\fB-r\fP [\fIGNBD(s)\fR]
Remove.

Remove named GNBD(s).
.TP
\fB-u\fP \fIuid\fR
Manually set UID.

Manually set the Universal Identifier for an exported device. This option is
used with \fB-e\fP. The UID is used by device-mapper-multipath to determine
which devices belong in a multipath map. A device must have a UID to be
multipathed. However, for most SCSI devices the default Get UID command
will return an appropriate id (see \fB-U\fP). \fBNOTE:\fP The UID refers to
the device being exported, not the GNBD itself. The UIDs of two GNBD devices
should be equal, only if they are exporting the same underlying device.
This means that both GNBD servers are connected to the same physical device.
\fBWARNING:\fP This should only be used for exporting shared storage devices,
when the \fB-U\fP command does not work. This should almost never happen for
SCSI devices. If two GNBD devices are not exporting the same underlying
device, but are given the same UID, data corruption WILL occur. You should
not use this option unless \fB-U\fP does not work for your setup, and you
understand why.
.TP
\fB-U\fP [\fIcommand\fR]
Get UID Command.

This is a command the gnbd_export will run to get a Universal Identifier for
the exported device. The UID is necessary to use device-mapper-multipath with
GNBD (see \fB-u\fP for more information). The command must use the full path
of any executable that you wish to run. A command can contain the %M, %m or
%n escape sequences. %M will be expanded to the major number of the exported
device, %m will be expanded to the minor number of the exported device, and
%n will be expanded to the sysfs name for the device. If no command is given,
gnbd will use the default command \fI"/usr/sbin/gnbd_get_uid"\fR. This
command will work for most scsi devices.
.TP
\fB-t\fP [\fIseconds\fR]
Timeout.

Set the exported GNBD to timeout mode  This option is used with \fB-p\fP.
This is the default for uncached GNBDs. For cached GNBDs, the default is wait
mode (For GFS versions up through 5.2, all GNBDs were in wait mode).  In wait
mode, if the connection to the server is lost, the gnbd client waits for the
connection to be reestablished, and then resends all the pending requests.  In
timeout mode, if the connection cannot be reestablished or if the gnbd client
does not receive a response from the server within the timeout period, the gnbd
client returns all
pending and future requests as failures until the imported GNBD is closed. The
default timeout period is 60 seconds. Timeout mode is necessary for failover to
work with dm multipathing over gnbd.
.TP
\fB-v\fP
Verbose.

Increase the verbosity of the output.  This option is the most useful with
\fB-l\fP.  If it is used along with \fB-l\fP, an extended list of information
on each exported device will be printed.
.TP
\fB-V\fP
Version information.

Print out version information.

.SH SEE ALSO
gnbd_import(8), gnbd(8)
