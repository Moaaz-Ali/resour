.\"  Copyright (C) Sistina Software, Inc.  1997-2003  All rights reserved.
.\"  Copyright (C) 2004 Red Hat, Inc.  All rights reserved.

.TH gnbd_import 8

.SH NAME
gnbd_import - manipulate GNBD block devices on a client

.SH SYNOPSIS
.B gnbd_import
[\fIOPTION\fR]...

.SH DESCRIPTION
gnbd_import imports, lists, and removes GNBDs from the system. GNBD is similar to
the Network Block Device (nbd) in the Linux kernel, except that it allows
multiple clients to connect at once and has a built-in fence command.

.SH OPTIONS
.TP
\fB-a\fP
Validate.

Restart failed gnbd_recvd processes. Usually, if a gnbd becomes
disconnected, the \fBgnbd_recvd\fP process for that device will automatically
try to reconnect. If that process is killed, \fBgnbd_import -a\fP will
restart it.
.TP
\fB-c \fIserver\fR
Check fenced.

List all the IP addresses currently IO fenced from the specified \fIserver\fR.
If the sepecified server does not have any IP addresses fenced, nothing will
be returned.  If the server machine is not running gnbd_serv, an error will
be returned.
.TP
\fB-e \fIserver\fR
List exported.

List GNBDs exported by the specified \fIserver\fR, along with the port at 
which they can be accessed. If the specified server is not exporting any GNBDs, 
nothing will be returned. If the server machine is not running gnbd_serv, an
error will be returned.
.TP
\fB-h\fP
Help.

Print the usage information.
.TP
\fB-i \fIserver\fR
Import.

Import all GNBDs which the specified \fIserver\fR has exported. This will not 
allow a GNBD to be imported if another one with the same name has already been
imported.
.TP
\fB-l\fP
List.

List all imported GNBDs. If no options are specified, this is the default 
action. There are eight fields for each device: Device name, Minor #, 
Proc name, Server, Port, State, Readonly and Sectors. The Device name is the
name that was chosen for 
the device when the server exported it. The Minor # is the minor number for 
the GNBD on the local machine.  The Proc name is the name for the 
device that will appear in /proc/partitions, since Linux does not allow 
devices in /proc/partitions to have arbitrary names. \fBNOTE:\fP A GNBD's 
Device name will be consistent across a cluster. Its Minor # and 
Proc name may not be.  Server and Port are the ones used to 
communicate with the GNBD's server. State describes the state of
the device.  It has three variables.  The first will either say \fBOpen\fP or 
\fBClosed\fP, depending on whether the imported GNBD is open or closed.
The second will either say \fBConnected\fP or \fBDisconnected\fP, depending
on whether or not there is a working TCP connection from the device to its
server.  When the connection is broken, this variable might not be immediately
updated.  The third variable will either say \fBPending\fP or \fBClear\fP, 
depending on whether or not there are any IO requests that the GNBD has sent
to the server, but which haven't been completed yet. Readonly tells whether
the gnbd server exported this device as readonly. Sectors is the device size
in 512 bytes sectors.
.TP
\fB-n\fP
No Cluster

This keeps gnbd_import from trying to contact the cluster manager.  This option
is used with \fB-i\fP. \fBNOTE:\fP With this option, it is not possible to
import uncached devices. \fBWarning:\fP This option should only be used in
situations that do not need any clustering. Attempting to use fence_gnbd to
block access to device imported with this option may silently fail, leading to
possible data corruption in a cluster environment.
.TP
\fB-O\fP
Override

This makes gnbd_import run in non-interactive mode.  It will no longer prompt
the user before attempting unsafe actions.  It is recommended that you do
not use this option.
.TP
\fB-p\fP
Port.

Change the port to connect to on the server.  This option is used with 
\fB-c\fP, \fB-e\fP and \fB-i\fP.  If the port option is not set, gnbd_import
will try to connect to port 14567 on the server machine to find the gnbd_serv 
daemon. You should only need to use this if you have changed the gnbd_serv
port from its default.
.TP
\fB-q\fP
Quiet mode.

Only print out errors or questions.
.TP
\fB-R\fP
Remove All.

Remove all of the imported GNBDs from the system. Only GNBDs that are in the 
\fBClosed Disconnected Clear\fP state can be removed (See the \fB-l\fP 
option), unless \fB-O\fP is used.  Remove All stops after the first failed
remove.
.TP
\fB-r\fP [\fIGNBD\fR | \fILIST\fR]
Remove.

Remove named GNBD(s) from system.  Only GNBDs that are in the \fBClosed 
Disconnected Clear\fP state can be removed (See the \fB-l\fP option), unless
the \fB-O\fP option is used.
Remove stops after the first failed remove. 
.TP
\fB-s\fP \fIhost\fR
Fence.

IO fence the specified host. This command is generally invoked by \fBfenced\fP.
\fBWARNING\fP It is
not always possible to seamlessly reconnect a client that has had its
connection cut. You should not execute this command manually unless you know
what you are doing. See the \fB-t\fP option for more information. Once a host
is fenced from a server, it will not be able to access any GNBDs on that server
until it is unfenced (see the \fB-u\fP option).
.TP
\fB-t\fP \fIserver\fR
Fence from Server.

Specify a server for the IO fence (only used with the \fB-s\fP option).
.TP
\fB-u\fP \fIhost\fR
Unfence.

Unfence the specified host. \fBWARNING\fP: Unfencing a client at the incorrect
time can result in data corruption.  In normal operation, it should never be
necessary to run this comman. See the \fB-t\fP option.
.TP
\fB-V\fP
Version information.

Print out version information.
.TP
\fB-v\fP
Verbose output.

Print additional messages during the operation of gnbd_import.

.SH SEE ALSO
gnbd_export(8)

.SH BUGS
A computer should not import a GNBD device that it exports.  Any 
significant amount of IO on that device will cause a kernel deadlock. This is 
a problem common to most NBDs. Instead, the underlying device should be
used directly. See gnbd_export for more on this.
