#!/bin/bash

# concept from Debian run-parts and similar from fedora crontabs

# keep going when something fails
set +e

if [ ! -d "@NOTIFYDDIR@" ]; then
	exit 0
fi

OUT="/dev/null 2>&1"

if [ "$CMAN_NOTIFICATION_DEBUG" = "1" ]; then
	OUT="@LOGDIR@/cman_notify.log"
fi

# Ignore *~ and *, scripts
for i in $(LC_ALL=C; echo @NOTIFYDIR@/*[^~,]); do
	[ -d $i ] && continue
	# skip know scripts
	[ "${i%.cfsaved}" != "${i}" ] && continue
	[ "${i%.rpmsave}" != "${i}" ] && continue
        [ "${i%.rpmorig}" != "${i}" ] && continue
        [ "${i%.rpmnew}" != "${i}" ] && continue
        [ "${i%.swp}" != "${i}" ] && continue
	[ "${i%,v}" != "${i}" ] && continue
	[ "${i%.dpkg-old}" != "${i}" ] && continue
	[ "${i%.dpkg-dist}" != "${i}" ] && continue
	[ "${i%.dpkg-new}" != "${i}" ] && continue

	[ -x $i ] && $i > $OUT
done

exit 0
